
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <title>pwn出题部分记录（自用（？） | Astesia&#39;s space</title>
    <meta name="author" content="Astesia" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://cdn.staticfile.net" />
<script src="https://cdn.staticfile.net/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.net/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.loli.net" />
<link rel="preconnect" href="https://gstatic.loli.net" crossorigin />
<link rel="stylesheet" href="https://fonts.loli.net/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.net/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.net/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>ASTESIA&#39;S SPACE</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ASTESIA&#39;S SPACE</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>pwn出题部分记录（自用（？）</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/7/6
        </span>
        
        <span class="category">
            <a href="/categories/pwn/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                pwn
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/%E5%87%BA%E9%A2%98/" style="color: #00bcd4">出题</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <p>在pwn简单题圈子里混了这么久，终于要第一次出题了，但是依旧有很多陌生的东西没接触过，所以这篇博客总结了一些出题过程中涉及到的点。（持续更新）</p>
<span id="more"></span>
<h2 id="1-gcc编译选项"><a class="header-anchor" href="#1-gcc编译选项">¶</a>1. gcc编译选项</h2>
<hr>
<p>通过编译选项可以直接打开或关闭程序的四项保护，默认全开，这里记录如何关闭/打开：</p>
<blockquote>
<ul>
<li>canary：-fno-stack-protector/-fstack-protector</li>
<li>NX：-z execstack/-z noexecstack</li>
<li>PIE:  -no-pie/-pie</li>
<li>RELRO：-z lazy（延迟绑定）、-z norelro（完全关闭）、-z now</li>
</ul>
</blockquote>
<p>在引入一些外来库时需要添加额外的选项，以下为博主遇到的例子：</p>
<blockquote>
<ul>
<li>seccomp: -lseccomp</li>
</ul>
</blockquote>
<p>下面是其他常用的编译选项：</p>
<blockquote>
<ul>
<li>编译32位程序：-m32</li>
<li>编译优化：-O0（default）、-O1、-O2、-O3（没尝试过区别）</li>
<li>忽略警告信息：-w</li>
<li>产生调试信息，gdb调试时显示c语言源码：-g</li>
<li>使用位置无关代码（PIC）：-fPIC</li>
</ul>
</blockquote>
<p>若想要使用高版本gcc编译出低版本GLIBC程序，则需要使用docker拉取一个旧版本Ubuntu镜像，在镜像中使用gcc编译，再将编译出的程序使用挂载卷取出。</p>
<h2 id="2-docker的简单使用"><a class="header-anchor" href="#2-docker的简单使用">¶</a>2. docker的简单使用</h2>
<hr>
<p>众所周知，pwn题最需要保证无误的是依赖文件和环境，因此便需要用到docker来制作对应的镜像以保存题目环境。不得不说实践是学习技术最有效的方式了，出题前一直搞不懂docker怎么用的。在这里梳理一下关于docker的一些指南。</p>
<h3 id="docker安装"><a class="header-anchor" href="#docker安装">¶</a>docker安装</h3>
<p>docker在Windows和Linux平台上的安装是不同的，Windows下首先需要安装wsl，然后直接安装docker desktop即可使用。但是这种方法有一个严重的问题，博主的pwn环境一直都是在虚拟机中的ubuntu环境下进行的，而docker desktop与vmware是<strong>无法共存</strong>的，网上搜到的解决方法没有能够同时打开两者的。因此不得不在linux下安装docker。</p>
<p><strong>warning: 如果同是使用vmware下的ubuntu环境，在尝试安装前请保留安装前快照，否则某些方法会导致系统崩掉（原因仍然未知）</strong></p>
<p>经多次坎坷的尝试，终于找到了不会出问题的安装方法，具体教程可以参考<a href="/https://m.sohu.com/a/708313241_121368355">本文</a>，亲测能够在博主的机子上非常顺利地进行下去。</p>
<h3 id="docker常用命令"><a class="header-anchor" href="#docker常用命令">¶</a>docker常用命令</h3>
<p>现在假设我们拥有一道出好的pwn题，指可执行程序，以及下载好的docker环境，接下来的第一步就是编写dockerfile。dockerfile中命令的语言为专用语言，具体语法可以通过各种官方网站查询学习；另一种方法就是程序员的必备技能——使用github上的项目。这里推荐一个很好用很全面的项目<a href="/https://github.com/CTF-Archives/ctf-docker-template">&gt;&gt;戳这里&lt;&lt;</a>。接下来只需要按照项目的要求把附件放入src文件夹即可。</p>
<p>那么如何玩转docker？只需记住下面几种命令</p>
<table>
<thead>
<tr>
<th style="text-align:center">command</th>
<th style="text-align:center">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>docker build -t {name:tag} .</strong></td>
<td style="text-align:center">执行dockerfile，build出对应的image</td>
</tr>
<tr>
<td style="text-align:center"><strong>docker images</strong></td>
<td style="text-align:center">列出当前所有镜像</td>
</tr>
<tr>
<td style="text-align:center"><strong>docker rmi {name|id}</strong></td>
<td style="text-align:center">删除对应镜像</td>
</tr>
<tr>
<td style="text-align:center"><strong>docker run -d --name={name:tag} -p {port}:9999 {name}</strong></td>
<td style="text-align:center">创建容器</td>
</tr>
<tr>
<td style="text-align:center"><strong>docker kill {name} &amp; docker rm {name}</strong></td>
<td style="text-align:center">杀死容器以及删除容器</td>
</tr>
<tr>
<td style="text-align:center"><strong>docker exec -it {name} /bin/bash</strong></td>
<td style="text-align:center">以root权限进入交互模式</td>
</tr>
</tbody>
</table>
<p>目前这些命令足以完成pwn题目创建的一套流程，可以检测远程环境能否如愿打通。</p>
<h3 id="其他可能用到的命令或选项"><a class="header-anchor" href="#其他可能用到的命令或选项">¶</a>其他可能用到的命令或选项</h3>
<table>
<thead>
<tr>
<th style="text-align:center">command</th>
<th style="text-align:center">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>docker  run --rm</strong></td>
<td style="text-align:center">容器停止后自动删除容器</td>
</tr>
<tr>
<td style="text-align:center"><strong>docker run -v {host_dir:container_dir}</strong></td>
<td style="text-align:center">为容器挂载卷</td>
</tr>
</tbody>
</table>
<h3 id="其他问题"><a class="header-anchor" href="#其他问题">¶</a>其他问题</h3>
<blockquote>
<h2 id="解决方法1"><a class="header-anchor" href="#解决方法1">¶</a>解决方法1</h2>
</blockquote>
<p>由于docker hub的功成身退（悲），在拉取ubuntu镜像时可能会报错，我们可以使用国内的镜像网站进行替代，这里记录一下博主的配置：</p>
<p>首先打开以下配置文件：</p>
<p><img src="/2024/07/06/pwn%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86%E8%AE%B0%E5%BD%95//cmd.png" alt="cmd"></p>
<p>在该文件中加入下方的配置，可以在浏览器中先尝试网址是否能够访问</p>
<p><img src="/2024/07/06/pwn%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86%E8%AE%B0%E5%BD%95//vim.png" alt="vim"></p>
<p>好了，配置完了，接下来可以去尝试docker build能否正常运行了。</p>
<p>附上一张正常执行的图：</p>
<p><img src="/2024/07/06/pwn%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86%E8%AE%B0%E5%BD%95//1.png" alt="1"></p>
<blockquote>
<h2 id="解决方法2"><a class="header-anchor" href="#解决方法2">¶</a>解决方法2</h2>
</blockquote>
<p>在一个伟大的日子10/24，我受到了群友邪恶的诅咒，导致docker又 build不出来了</p>
<p><img src="/2024/07/06/pwn%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86%E8%AE%B0%E5%BD%95//curse.png" alt="curse"></p>
<p>通过搜索引擎最终找到了新的<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2461002">解决方法</a>。</p>
<pre><code class="language-bash">sudo vim /etc/systemd/system/docker.service.d/http-proxy.conf
</code></pre>
<p>然后添加如下内容，即设置代理地址</p>
<pre><code class="language-conf">[Service]
Environment=&quot;HTTP_PROXY=http://127.0.0.1:7890&quot;
Environment=&quot;HTTPS_PROXY=http://127.0.0.1:7890&quot;
Environment=&quot;NO_PROXY=localhost,127.0.0.1&quot;
</code></pre>
<p>其中127.0.0.1:7890需要改成梯子监听的实际代理地址和端口，以本次为例，需要修改为</p>
<p><img src="/2024/07/06/pwn%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86%E8%AE%B0%E5%BD%95//proxy.png" alt="proxy"></p>
<p>此时即可正常从docker.io中拉取ubuntu镜像了。</p>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 Astesia&#39;s space
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Astesia
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>


        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
    <script src="/js/highlight.js"></script>
    <link rel="stylesheet" href="/css/highlight/styles/github.css" />
</body>
</html>
